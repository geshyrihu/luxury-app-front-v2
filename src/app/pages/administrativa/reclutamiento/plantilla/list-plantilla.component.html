<p-toast position="top-left" [baseZIndex]="99999"></p-toast>

<div class="card">
  <p-table
    #dt
    [value]="data"
    [globalFilterFields]="['professionName', 'departament', 'employeeName']"
    styleClass="custom-table"
  >
    <!-- rowGroupMode="subheader"
    groupRowsBy="responsibleArea.nameArea" -->
    <ng-template pTemplate="caption">
      <app-table-header
        [title]="'POSICIÓNES DE TRABAJO'"
        (add)="onModalAddOrEdit({ id: 0, title: 'Nuevo Registro' })"
        [dt]="dt"
        [rolAuth]="
          authService.onValidateRoles([
            'Asistente',
            'Residente',
            'SuperUsuario'
          ])
        "
      ></app-table-header>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th
          style="width: 15%"
          scope="col"
          pSortableColumn="departamentHierarchy"
        >
          Departamento <p-sortIcon field="departamentHierarchy"></p-sortIcon>
        </th>
        <th
          *ngIf="
            authService.onValidateRoles([
              'SupervisionOperativa',
              'SuperUsuario',
              'Residente',
              'Asistente',
              'Reclutamiento'
            ])
          "
          style="width: 15%"
          scope="col"
          pSortableColumn="estatus"
        >
          Tickets <p-sortIcon field="estatus"></p-sortIcon>
        </th>
        <th
          style="width: 15%"
          scope="col"
          pSortableColumn="professionHierarchy"
        >
          Puesto <p-sortIcon field="professionHierarchy"></p-sortIcon>
        </th>
        <th style="width: 10%" scope="col" pSortableColumn="turnoTrabajo">
          Turno
          <p-sortIcon field="turnoTrabajo"></p-sortIcon>
        </th>
        <th
          *ngIf="
            authService.onValidateRoles([
              'SupervisionOperativa',
              'SuperUsuario',
              'Residente',
              'Asistente',
              'Reclutamiento'
            ])
          "
          style="width: 10%"
          scope="col"
          pSortableColumn="sueldoFiltro"
        >
          Sueldo<p-sortIcon field="sueldoFiltro"></p-sortIcon>
        </th>
        <th style="width: 30%" scope="col" pSortableColumn="empleado">
          Empleado
          <p-sortIcon field="empleado"></p-sortIcon>
        </th>
        <th
          style="width: 20%"
          scope="col"
          *ngIf="
            authService.onValidateRoles([
              'SupervisionOperativa',
              'SuperUsuario',
              'Residente',
              'Asistente'
            ])
          "
        >
          Opciones
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-item>
      <!-- Si no hay empleado, entonces la vacangte no esta cubierta y se pone en rojo -->
      <tr>
        <td>
          {{ item.departament }}
        </td>
        <td
          *ngIf="
            authService.onValidateRoles([
              'SupervisionOperativa',
              'SuperUsuario',
              'Residente',
              'Asistente',
              'Reclutamiento'
            ])
          "
        >
          <!-- Si hay una ultima solicitud en estatus de pendiente -->
          <div
            class="d-flex justify-content-center"
            *ngIf="onValidateShowTIcket(item.professionId)"
          >
            <custom-button
              *ngIf="item.positionRequest.status === 0"
              ngbTooltip="Solicitud de vacante vigente"
              placement="top"
              customClass="btn-sm btn-outline-secondary"
              icon="fa-duotone fa-ticket fa-2x"
              (clicked)="onRouteEstatusSolicitud(item.positionRequest.id)"
            ></custom-button>
            <custom-button
              *ngIf="item.requestDismissal === 0"
              ngbTooltip="Solicitud de baja vigente"
              placement="top"
              customClass="btn-sm btn-outline-danger"
              icon="fa-duotone fa-ticket fa-2x"
              (clicked)="onRouteEstatusRequestDismissal(item.id)"
            ></custom-button>
            <custom-button
              *ngIf="item.requestSalaryModification === 0"
              ngbTooltip="Solicitud modificacion de salario vigente"
              placement="top"
              customClass="btn-sm btn-outline-success"
              icon="fa-duotone fa-ticket fa-2x"
              (clicked)="
                onRouteEstatusSalaryModification(item.employeeId, item.id)
              "
            ></custom-button>
          </div>
        </td>
        <td
          [ngClass]="{
          'fondo-rojo-tenue': !item.empleado,
        }"
        >
          {{ item.professionName }}
        </td>
        <td>
          {{ item.turno }}
        </td>
        <td
          *ngIf="
            authService.onValidateRoles([
              'SupervisionOperativa',
              'SuperUsuario',
              'Residente',
              'Asistente',
              'Reclutamiento'
            ])
          "
        >
          {{ item.sueldo }}
        </td>
        <td>
          <img
            (click)="onCardEmployee(item.employeeId)"
            *ngIf="item.fotoEmpleado"
            [src]="pahtBaseImg + item.fotoEmpleado"
            class="rounded avatar-sm pointer me-3"
            alt=""
          />
          <i
            *ngIf="!item.fotoEmpleado"
            class="fa-duotone fa-user-xmark fa-2x"
          ></i>
          {{ item.empleado }}
        </td>

        <td
          *ngIf="
            authService.onValidateRoles([
              'SupervisionOperativa',
              'SuperUsuario',
              'Residente',
              'Asistente'
            ])
          "
        >
          <div class="d-flex justify-content-end">
            <!-- Si ya hay una solicitud enviada y pendiente  No se puede enviar una solicitud -->
            <!-- para el caso de administradores solo puede enviar supervisión -->
            <custom-button
              *ngIf="
                item.positionRequest.status !== 0 &&
                onValidateRole(item.professionId)
              "
              ngbTooltip="Solicitar vacante"
              placement="top"
              customClass="btn-sm btn-outline-secondary"
              icon="fa-duotone fa-user-magnifying-glass "
              (clicked)="onModalSolicitudVacante(item.id)"
            ></custom-button>
            <!-- {{ onModalSolicitudVacante(item.id) }} -->

            <!-- Si no hay Empleado y una solicitud de baja pendiente no se puede solicitar la baja -->
            <custom-button
              *ngIf="
                item.empleado &&
                item.requestDismissal !== 0 &&
                onValidateRole(item.professionId)
              "
              ngbTooltip="Solicitar baja"
              placement="top"
              customClass="btn-sm btn-outline-danger"
              icon="fa-duotone fa-user-minus "
              (clicked)="onModalSolicitudBaja(item.id)"
            ></custom-button>
            <!-- Si no hay Empleado y una solicitud de modificacion de salario pendiente no se puede solicitar la baja -->

            <custom-button
              *ngIf="
                item.requestSalaryModification !== 0 &&
                onValidateRole(item.professionId)
              "
              ngbTooltip="Solicitar modificación de salario"
              placement="top"
              customClass="btn-sm btn-outline-success"
              icon="fa-duotone fa-money-bill-1 "
              (clicked)="onModalSolicitudModificacionSalarion(item.id)"
            ></custom-button>

            <custom-button
              ngbTooltip="Descripción de puesto"
              placement="top"
              customClass="btn-sm btn-outline-primary"
              icon="fa-duotone fa-book "
              (clicked)="onModalJobDescription(item.professionId)"
            ></custom-button>

            <custom-button
              ngbTooltip="Horarios"
              placement="top"
              customClass="btn-sm btn-outline-primary"
              icon="fa-duotone fa-clock"
              (clicked)="onModalHoursWorkPosition(item.id)"
            ></custom-button>

            <custom-button-edit
              *ngIf="
                authService.onValidateRoles([
                  'SuperUsuario',
                  'Residente',
                  'Asistente'
                ])
              "
              (edit)="
                onModalAddOrEdit({ id: item.id, title: 'Editar Registro' })
              "
            ></custom-button-edit>

            <!-- Solamente puede eliminar superusuario -->

            <custom-button-delete
              *ngIf="authService.onValidateRoles(['SuperUsuario'])"
              (OnConfirm)="onDelete(item.id)"
            ></custom-button-delete>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="summary">
      <div class="flex align-items-center justify-content-between">
        Total {{ data ? data.length : 0 }} vacantes.
      </div>
    </ng-template>
  </p-table>
</div>

<style>
  /* Definición de la clase CSS para el fondo rojo tenue */
  .fondo-rojo-tenue {
    background-color: rgba(
      255,
      0,
      0,
      0.1
    ) !important; /* 0.1 es la opacidad del fondo (0 = transparente, 1 = opaco) */
  }
  /* Definición de la clase CSS para el fondo verde tenue */
  .fondo-verde-tenue {
    background-color: rgba(
      0,
      128,
      0,
      0.1
    ) !important; /* 0.1 es la opacidad del fondo (0 = transparente, 1 = opaco) */
  }
</style>
